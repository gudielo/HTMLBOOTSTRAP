<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Comercio Web</title>
  <link rel="stylesheet" href="css/bootstrap.min.css" />

  <style>
    .badge-carrito {
      position: absolute;
      top: 0;
      right: 0;
      transform: translate(50%, -50%);
      background-color: #dc3545;
      color: white;
      font-size: 0.7rem;
      border-radius: 50%;
      padding: 3px 6px;
    }

    .sidebar-categorias {
      background-color: #f1f1f1;
      border-radius: 8px;
      padding: 15px;
    }

    .producto-item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      transition: box-shadow 0.2s;
      background-color: #ffffff;
    }

    .producto-item:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    footer {
      background-color: #343a40;
      color: white;
      padding: 20px 0;
      margin-top: 60px;
    }
  </style>
</head>
<body>

  <!-- Barra superior con carrito -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid justify-content-between">
      <a class="navbar-brand" href="#">Mi Comercio</a>
      <button class="btn btn-light position-relative">
        üõçÔ∏è
        <span id="contadorCarrito" class="badge-carrito">0</span>
      </button>
    </div>
  </nav>

  <!-- Carrusel -->
  <div id="miCarrusel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="https://placehold.co/2000x400" class="d-block w-100" alt="Imagen 1" />
      </div>
      <div class="carousel-item">
        <img src="https://placehold.co/2000x400" class="d-block w-100" alt="Imagen 2" />
      </div>
      <div class="carousel-item">
        <img src="https://placehold.co/2000x400" class="d-block w-100" alt="Imagen 3" />
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#miCarrusel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#miCarrusel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>

  <!-- Contenido principal -->
  <div class="container mt-5">
    <div class="row">

      <!-- Barra lateral de categor√≠as din√°micas -->
      <aside class="col-md-3">
        <div class="sidebar-categorias">
          <h6 class="mb-3 text-primary">Explorar categor√≠as</h6>
          <ul id="contenedorCategorias" class="list-group list-group-flush">
            <!-- Categor√≠as din√°micas se insertar√°n aqu√≠ -->
          </ul>
        </div>
      </aside>

      <!-- Productos -->
      <section class="col-md-9">
        <div class="row" id="contenedorProductos">
          <!-- Productos se insertar√°n aqu√≠ din√°micamente -->
        </div>
      </section>

    </div>
  </div>

  <!-- Pie de p√°gina -->
  <footer class="text-center">
    <p class="mb-0">¬© 2025 - Creado por Diego Gilberto Gudiel Orellana | 1890-20-18555</p>
  </footer>

  <!-- Scripts -->
  <script src="js/bootstrap.bundle.min.js"></script>

  <!-- C√≥digo JavaScript integrado -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlProductos = "https://backcvbgtmdesa.azurewebsites.net/api/productos";
      const urlCategorias = "https://backcvbgtmdesa.azurewebsites.net/api/categorias";

      const contenedorProductos = document.getElementById("contenedorProductos");
      const contenedorCategorias = document.getElementById("contenedorCategorias");
      const contadorCarrito = document.getElementById("contadorCarrito");

      let carrito = 0;
      let productosGlobal = [];
      let categoriasGlobal = [];

      // Mostrar productos, con filtro opcional por categor√≠a
      function mostrarProductos(filtroCategoriaId = null) {
        contenedorProductos.innerHTML = "";

        const productosMostrar = filtroCategoriaId
          ? productosGlobal.filter(p => p.CategoriaId === filtroCategoriaId)
          : productosGlobal;

        if (productosMostrar.length === 0) {
          contenedorProductos.innerHTML = `<div class="alert alert-warning">No hay productos para esta categor√≠a.</div>`;
          return;
        }

        productosMostrar.forEach(producto => {
          const col = document.createElement("div");
          col.className = "col-md-4 col-sm-12 p-2";

          let precioHTML = "";
          if (producto.EnOferta && producto.PrecioOferta != null) {
            precioHTML = `
              <span class="text-danger">$${parseFloat(producto.PrecioOferta).toFixed(2)}</span>
              <small class="text-muted text-decoration-line-through">$${parseFloat(producto.Precio).toFixed(2)}</small>
            `;
          } else {
            precioHTML = `$${parseFloat(producto.Precio).toFixed(2)}`;
          }

          col.innerHTML = `
            <div class="card">
              <img src="${producto.Imagen}" class="card-img-top" alt="${producto.Nombre}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${producto.Nombre}</h5>
                <p class="card-text">${producto.Descripcion}</p>
                <p class="fw-bold">${precioHTML}</p>
                <a href="javascript:void(0)" class="btn btn-primary mt-auto agregarCarrito">Agregar al carrito</a>
              </div>
            </div>
          `;

          col.querySelector(".agregarCarrito").addEventListener("click", (e) => {
            e.preventDefault();
            carrito++;
            contadorCarrito.textContent = carrito;
          });

          contenedorProductos.appendChild(col);
        });
      }

      // Mostrar categor√≠as din√°micamente
      function mostrarCategorias() {
        contenedorCategorias.innerHTML = "";

        const liTodas = document.createElement("li");
        liTodas.className = "list-group-item";
        liTodas.textContent = "Todas";
        liTodas.style.cursor = "pointer";
        liTodas.style.color = "#0d6efd";
        liTodas.style.fontWeight = "bold";
        liTodas.addEventListener("click", () => {
          mostrarProductos(null);
          marcarCategoriaSeleccionada(null);
        });
        contenedorCategorias.appendChild(liTodas);

        categoriasGlobal.forEach(categoria => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.textContent = categoria.descripcion;
          li.style.cursor = "pointer";
          li.style.color = "#0d6efd";

          li.addEventListener("click", () => {
            mostrarProductos(categoria.id_categoria);
            marcarCategoriaSeleccionada(categoria.id_categoria);
          });

          contenedorCategorias.appendChild(li);
        });
      }

      // Marcar la categor√≠a seleccionada visualmente
      function marcarCategoriaSeleccionada(idCategoria) {
        [...contenedorCategorias.children].forEach(li => {
          li.style.backgroundColor = "";
          li.style.color = "#0d6efd";

          
          if (
            (idCategoria === null && li.textContent === "Todas") ||
            (idCategoria !== null &&
              li.textContent === categoriasGlobal.find(cat => cat.id_categoria === idCategoria)?.descripcion)
          ) {
            li.style.backgroundColor = "#0d6efd";
            li.style.color = "white";
          }
        });
      }

      // Cargar productos y categor√≠as
      Promise.all([
        fetch(urlCategorias).then(res => res.json()),
        fetch(urlProductos).then(res => res.json())
      ]).then(([categorias, productos]) => {
        categoriasGlobal = categorias;
        productosGlobal = productos;

        mostrarCategorias();
        mostrarProductos();
        marcarCategoriaSeleccionada(null);
      }).catch(error => {
        console.error("Error al cargar datos:", error);
        contenedorProductos.innerHTML = '<div class="alert alert-danger">No se pudieron cargar los productos.</div>';
        contenedorCategorias.innerHTML = '<div class="alert alert-danger">No se pudieron cargar las categor√≠as.</div>';
      });
    });
  </script>
</body>
</html>

